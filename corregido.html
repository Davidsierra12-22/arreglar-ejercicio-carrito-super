<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Mini-Market POS - Corregido</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #e9ecef; }
        .pos-container { max-width: 400px; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin: auto; }
        input { width: 100%; padding: 10px; margin-bottom: 10px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; }
        button { width: 100%; padding: 10px; background: #28a745; color: white; border: none; cursor: pointer; border-radius: 4px; font-weight: bold; }
        button:hover { background: #218838; }
        ul { list-style-type: none; padding: 0; background: white; border: 1px solid #ddd; border-radius: 4px; }
        li { padding: 10px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; }
        li:last-child { border-bottom: none; }
        .total-box { font-size: 1.2em; font-weight: bold; margin-top: 15px; text-align: right; color: #333; }
        .descuento { color: #d9534f; font-size: 0.9em; }
    </style>
</head>
<body>

<div class="pos-container">
    <h2>üè™ Caja Registradora</h2>

    <label>Producto:</label>
    <input type="text" id="nombre" placeholder="Ej: Arroz 1kg">

    <label>Precio:</label>
    <input type="number" id="precio" placeholder="0">

    <button onclick="agregarAlCarrito()">‚ûï Agregar Producto</button>

    <h3>Lista de Compra:</h3>
    <ul id="lista-visual"></ul>

    <div class="total-box">
        Total a Pagar: $<span id="total-pagar">0.00</span>
    </div>
</div>

<script>
    let carrito = [];
    const IVA_PERCENT = 0.19;

    function agregarAlCarrito() {
        let nombreInput = document.getElementById("nombre");
        let precioInput = document.getElementById("precio");

        // VALIDACI√ìN: No agregar productos vac√≠os o con precio 0
        if(nombreInput.value.trim() === "" || precioInput.value <= 0) {
            alert("Por favor ingresa un nombre y un precio v√°lido.");
            return;
        }

        let nuevoItem = {
            producto: nombreInput.value,
            // CORRECCI√ìN: Convertimos a Number para evitar concatenaciones de texto
            costo: parseFloat(precioInput.value)
        };

        carrito.push(nuevoItem);
        
        // LIMPIEZA: Reseteamos los campos despu√©s de agregar
        nombreInput.value = "";
        precioInput.value = "";
        nombreInput.focus();

        actualizarPantalla();
    }

    function actualizarPantalla() {
        let listaUL = document.getElementById("lista-visual");
        let spanTotal = document.getElementById("total-pagar");

        // CORRECCI√ìN "Fuga Visual": Limpiamos la lista antes de volver a dibujar
        // Si no se hace esto, el c√≥digo anterior repet√≠a toda la lista cada vez
        listaUL.innerHTML = "";

        let sumaSubtotal = 0;

        carrito.forEach(function(item) {
            // Dibujamos el elemento en el DOM
            let li = document.createElement("li");
            li.innerHTML = `<span>${item.producto}</span> <span>$${item.costo.toLocaleString()}</span>`;
            listaUL.appendChild(li);

            // Sumamos el costo neto
            sumaSubtotal += item.costo;
        });

        // CORRECCI√ìN IVA: Calculamos el total incluyendo el impuesto (119%)
        let totalConIva = sumaSubtotal * (1 + IVA_PERCENT);

        // CORRECCI√ìN DESCUENTO: Aplicamos regla de negocio (compra > 50.000)
        if (totalConIva > 50000) {
            console.log("¬°Descuento del 10% aplicado!");
            // Restamos el 10% al total que ya tiene IVA
            totalConIva = totalConIva * 0.90; 
            spanTotal.style.color = "#d9534f"; // Indicador visual de descuento
        } else {
            spanTotal.style.color = "#333";
        }

        // CORRECCI√ìN FORMATO: Mostramos solo 2 decimales para dinero
        spanTotal.innerText = totalConIva.toLocaleString('es-CO', { minimumFractionDigits: 2 });
    }
</script>

</body>
</html>